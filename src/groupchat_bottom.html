<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title></title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script src="shared.js" language="JavaScript1.2"></script>
    <script src="switchStyle.js"></script>
    <script language="JavaScript1.2">
      <!--

function submitClicked() {
  var url = "?sid=" + parent.srcW.sid + "&to=" + parent.group;
  var body = document.forms[0].elements["msgbox"].value;
  

  if (body == '') // don't send empty message
    return false;
          
  /* handle commands */
  if (body.match(/^\/nick (.+)/)) {
    var nick = body.replace(/^\/nick (.+)/,"$1");
    url += "/"+msgEscape(nick);
    parent.srcW.fhdLoad("presence",url);
  } else if (body.match(/^\/topic (.+)/)) {
    var topic = body.replace(/^\/topic (.+)/,"$1");
    url += "&type=groupchat&subject="+msgEscape(topic);
    parent.srcW.fhdLoad("message",url);
  } else {
    url += "&body=" + msgEscape(body) + "&type=groupchat";
    parent.srcW.fhdLoad("message",url); // send to client
  }			

  // add message to our message history
  parent.srcW.addtoHistory(body);
  document.forms["chatform"].msgbox.value=''; // empty box
  document.forms["chatform"].msgbox.focus(); // set focus back on input field
  
  /* poll (almost) immediatly to get my own response */
  setTimeout("parent.srcW.poll()",200);

  return false;
}

   function keyPressed(e) {
     if ((e.ctrlKey && e.keyCode == 13) || (e.metaKey && e.keyCode == 77)) 
       return submitClicked();
     else {
       switch (e.keyCode) {
       case 27:
         parent.close();
         break;
       case 38:				// shift+up
         if (e.ctrlKey) {
           el = document.forms["chatform"].msgbox;
           el.value = parent.srcW.getHistory('up', el.value);
           el.focus(); el.select();
         }
         break;
       case 40:				// shift+down 
         if (e.ctrlKey) {
           el = document.forms["chatform"].msgbox;
           el.value = parent.srcW.getHistory('down', el.value);
           el.focus(); el.select();
         }
         break;
       case 76:
         if (e.ctrlKey) {   // ctrl+l
           parent.cFrame.body.innerHTML = '';
           return false;
         }
       }
     }
     return true;
   }
onkeydown = keyPressed;
      //-->
    </script>
    <script for="document" event="onkeydown()" language="JScript">
      <!--
      return keyPressed(window.event);
      //-->
    </script>
  </head>
  <body style="margin:8px;">
    <form name="chatform">
      <table width="100%" height="100%" border=0 cellpadding=0 cellspacing=0>
          <tr height="100%">
            <td width="100%"><textarea id="msgbox" wrap="virtual" style="width:100%;height:100%;"></textarea></td></tr>
          <tr><td height=5></td></tr>
          <tr>
            <td align="right"><button id="config_chan_button" onClick="return parent.openConfig();" disabled><l>Config</l></button>&nbsp;<button id='submit' name='submit' type='submit' onClick="return submitClicked();"><l>Send</l></button></td></tr>
      </table>
    </form>
  </body>
</html>
