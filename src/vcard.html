<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<title><l>JWChat - VCard - </l></title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<script src="shared.js" language="JavaScript1.2"></script>
    <script src="switchStyle.js"></script>
		<script language="JavaScript1.2">
		<!--
		var jid , vcard;
		var srcW; // the source window with necessary data

    function sendSub() {
      var params = "?sid="+srcW.sid;

      for (var i=0; i<document.forms[0].elements.length; i++) {
        if (document.forms[0].elements[i].id == '') continue;
        if (document.forms[0].elements[i].value == '' ) continue;
        params += "&"+msgEscape(document.forms[0].elements[i].id)+"="+msgEscape(document.forms[0].elements[i].value);
      }

      srcW.fhdLoad("vcard-set",params);
      window.close();
      return false;
    }

    function fillVCard(vcard,prefix) {
      for (var i in vcard) {
        if (typeof(vcard[i]) == 'object') {
          fillVCard(vcard[i],i+".");
          continue;
        }
        if (typeof(document.forms[0].elements[prefix+i]) == 'undefined') continue;
        document.forms[0].elements[prefix+i].value = vcard[i];
      }

    }

    function handleVCardTemp(jabber) {

			if (jabber.error || jabber.type == 'error') {
				srcW.fdebug(jabber,1);
				return;
			}

			srcW.fdebug(jabber,2);
			
			if (typeof(jabber.ns) == 'undefined' || jabber.ns != 'vcard-temp') // not form me
				return;
			
      fillVCard(jabber.vcard,'');
		}


    function init() {
      srcW = opener.top;

      getArgs();

      jid = passedArgs['jid'];
      document.title += jid;
  
      for (var i=0; i<document.forms[0].elements.length;i++) {
        if (document.forms[0].elements[i].id == '') continue;
        if (cutResource(jid) != srcW.cutResource(srcW.jid)) {
          document.forms[0].elements[i].className = "vcardBox";
          document.forms[0].elements[i].readOnly = true;
        }
      }

      if (cutResource(jid) != srcW.cutResource(srcW.jid))
        document.getElementById("savebox").style.display = 'none';

			// request vcard
			if (cutResource(jid) == cutResource(srcW.jid)) { // it's me
				var vcardW = window;
				srcW.fCBLoad("vcard","?sid="+srcW.sid+"&to="+msgEscape(jid),vcardW.handleVCardTemp);
			} else {
				var roster = srcW.roster;
				if (roster.getUserByJID(cutResource(jid)).roster) // groupchat(!)
					srcW.fCBLoad("vcard","?sid="+srcW.sid+"&to="+msgEscape(jid),roster.getUserByJID(cutResource(jid)).roster.getUserByJID(jid).vcardW.handleVCardTemp);
				else
					srcW.fCBLoad("vcard","?sid="+srcW.sid+"&to="+msgEscape(jid),roster.getUserByJID(jid).vcardW.handleVCardTemp);
			}
      
    }

		function keyPressed(e) {
			if (e.keyCode == 27)
				window.close();
		}
		onkeydown = keyPressed;
		onload = init;
		//-->
		</script>
		<script for="document" event="onkeydown()" language="JScript">
		<!--
			if (window.event.keyCode == 27)
				window.close();
		//-->
		</script>
    <style type="text/css">
      <!--
      th { 
      font-family: sans-serif;
      font-size: 12px;
      text-align: right;
      }
      // -->
    </style>
	</head>
	<body style="margin:8px">
    <form>
    <fieldset>
      <legend><l>Name</l></legend>
      <table>
          <tr><th nowrap><l>Full Name</l>:</th><td width="100%"><input type=text id="FN" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Family Name</l>:</th><td width="100%"><input type=text id="N.FAMILY" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Name</l>:</th><td width="100%"><input type=text id="N.GIVEN" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Nickname</l>:</th><td width="100%"><input type=text id="NICKNAME" class="vcardBoxEditable"></td></tr>
      </table>
    </fieldset>
    
    <fieldset>
      <legend><l>Information</l></legend>
      <table>
          <tr><th nowrap><l>E-mail</l>:</th><td width="100%"><input type=text id="EMAIL" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Web Site</l>:</th><td width="100%"><input type=text id="URL" class="vcardBoxEditable"></td></tr>
      </table>
    </fieldset>
    
    <fieldset>
      <legend><l>Address</l></legend>
      <table>
          <tr><th nowrap><l>Address</l>:</th><td width="100%"><input type=text id="ADR.STREET" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Address2</l>:</th><td width="100%"><input type=text id="ADR.EXTADD" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>City</l>:</th><td width="100%"><input type=text id="ADR.LOCALITY" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>State</l>:</th><td width="100%"><input type=text id="ADR.REGION" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Postal Code</l>:</th><td width="100%"><input type=text id="ADR.PCODE" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Country</l>:</th><td width="100%"><input type=text id="ADR.CTRY" class="vcardBoxEditable"></td></tr>
      </table>
    </fieldset>

    <fieldset>
      <legend><l>Organization</l></legend>
      <table>
          <tr><th nowrap><l>Name</l>:</th><td width="100%"><input type=text id="ORG.ORGNAME" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Unit</l>:</th><td width="100%"><input type=text id="ORG.ORGUNIT" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Title</l>:</th><td width="100%"><input type=text id="TITLE" class="vcardBoxEditable"></td></tr>
          <tr><th nowrap><l>Role</l>:</th><td width="100%"><input type=text id="ROLE" class="vcardBoxEditable"></td></tr>
      </table>
    </fieldset>

    <fieldset>
      <legend><l>About</l></legend>
      <table>
          <tr><th><l>Birthday</l>:</th><td width="100%"><input type=text id="BDAY" class="vcardBoxEditable"></td></tr>
          <tr><th><l>Description</l>:</th><td width="100%"><input type=text id="DESC" class="vcardBoxEditable"></td></tr>
      </table>
    </fieldset>
    <div id="savebox">
		<hr noshade size="1" size="100%">
		<div align="right">
			<button onClick="window.close();"><l>Cancel</l></button>&nbsp;<button onClick="return sendSub();"><l>Save</l></button>
		</div>
      </div>
    </form>
	</body>
</html>
