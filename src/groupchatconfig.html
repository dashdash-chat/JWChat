<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title><l>JWChat - Channel Config for</l></title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script src="shared.js" language="JavaScript1.2"></script>
    <script src="jabber_x_data.js" language="JavaScript1.2"></script>
    <script src="switchStyle.js"></script>
    <script language="JavaScript1.2">
      <!--

function doSub() {
	var els = document.forms[0].elements;

	var xml = "<x xmlns='jabber:x:data' type='submit'>";

	for (var i=0; i<els.length; i++) {
		if (els[i].name == '' || els[i].value == '')
			continue;
		xml += "<field var='" +els[i].name + "'><value>";
		if (els[i].type == 'checkbox')
			xml += (els[i].checked) ? '1':'0';
		else
			xml += els[i].value;
		xml += "</value></field>";
	}

	xml += "</x>";
	srcW.fhdLoad("iq","?sid="+srcW.sid+"&to="+msgEscape(opener.jid)+"&ns="+escape("http://jabber.org/protocol/muc#owner")+"&set="+msgEscape(xml));
	window.close();
	return false;
}

function destroy() {
	reason = prompt(loc("Really destroy this room?\n\nReason:"),"");
	if (!reason)
		return false;

	srcW.fhdLoad("iq","?sid="+srcW.sid+"&to="+msgEscape(opener.jid)+"&ns=http://jabber.org/protocol/muc%23owner&set="+msgEscape("<destroy><reason>"+reason+"</reason></destroy>"));
	window.close();
	return false;
}
	
function handleConfig(jabber) {
	srcW.Debug.log(jabber,2);

	if (jabber.type == 'error')
		return;

	if (typeof(jabber.browse) == 'undefined' || typeof(jabber.browse.o) == 'undefined')
		return;

	// get x
	var x;
	for (var i in jabber.browse.o)
		if (jabber.browse.o[i].tagname == 'x' && jabber.browse.o[i].type == 'form') {
			x = jabber.browse.o[i];
			break;
		}

	document.getElementById("jabberXDataForm").innerHTML = genJabberXDataTable(x);
}

var srcW;
function init() {
  // determine source window
	srcW = opener.srcW;

	document.title += " " + opener.jid;

	var roster = srcW.roster;
	srcW.fCBLoad("iq","?sid="+srcW.sid+"&to="+msgEscape(opener.jid)+"&ns="+escape("http://jabber.org/protocol/muc#owner"),roster.getUserByJID(opener.jid).chatW.configW.handleConfig);
}

function keyPressed(e) {
  if (e.keyCode == 13)
    return doSub();
  if (e.keyCode == 27)
    window.close();
  return true;
}

onkeydown = keyPressed;
onload = init;
      //-->
    </script>
    <script for="document" event="onkeydown()" language="JScript">
      <!--
      return keyPressed(window.event);
      //-->
    </script>
		<style type="text/css">
			th { font-size: 80%; text-align: right; font-weight: normal; }
		</style>
  </head>
  <body style="margin:8px;">
    <form name="sub" onsubmit="return doSub();">
		<div id="jabberXDataForm">
		</div>
      <hr noshade size="1" size="100%">
      <div align="right" id="buttonbox">
        <button onClick="return destroy();"><l>Destroy</l></button>&nbsp;<button onClick="window.close();"><l>Cancel</l></button>&nbsp;<button type="submit"><l>OK</l></button>
      </div>
		</form>
  </body>
</html>
