<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title><l>Welcome to JWChat</l></title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script src="config.js" language="JavaScript1.2"></script>
    <script src="browsercheck.js" language="JavaScript1.2"></script>
    <script src="shared.js" language="JavaScript1.2"></script>
    <script src="switchStyle.js"></script>
    <script src="sha1.js"></script>
    <script language="JavaScript">
<!--

 /*
  * JWChat, a web based jabber client
  * Copyright (C) 2003-2004 Stefan Strigler <steve@zeank.in-berlin.de>
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License
  * as published by the Free Software Foundation; either version 2
  * of the License, or (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
  *
  * Please visit http://jwchat.sourceforge.net for more information!
  */

var jid, pass, state;
function loginCheck(form) { /* check if user want's to register new
																 account and things */

	if (form.jid.value == '') {
		alert(loc("You need to supply a username"));
		return false;
	}

	if (form.pass.value == '') {
		alert(loc("You need to supply a password"));
		return false;
	}

  jid = form.jid.value + "@" + JABBERSERVER + "/";
	if (form.res.value != '')
		jid += form.res.value;
	else
		jid += DEFAULTRESOURCE;

  if(!isValidJID(jid))
    return false;

  pass = form.pass.value;

	/* return openRoster(form); */ // don't use plaintext passwords!

	if (form.register.checked) {
		state = 'handleregister';
		frameLoad("pub/register","?jid="+msgEscape(jid)+"&pass="+msgEscape(pass));
	} else {
		state = 'getstreamid';
		frameLoad("login-sid","?jid="+msgEscape(jid));
	}

	return false;
}

function openRoster(form) {
  window.open('jwchat.html?jid='+escape(jid)+'&pass='+escape(pass),makeWindowName(jid),'width=180,height=360,resizable=yes');
  return false;
}

function handleEvent() {
	var jabber = frames['hiddenframe'].jabber;
	if (!jabber)
		return;

	if (typeof(state) == 'undefined' || state == '')
		return;


	switch (state) {
	case 'handleregister':
		if (jabber.error) {
			alert(loc("Registration failed. You might want to choose another username."));
			return false;
		}
		/* seems like a successul registration*/
		document.forms[0].register.checked = false; // uncheck this for the user

		state = 'getstreamid';
		frameLoad("login-sid","?jid="+msgEscape(jid));
		break;
	case 'getstreamid':
		if (jabber.error) {
			alert("An error occured!\\nAborting...");
			return false;
		}
		if (typeof(jabber.streamid) == 'undefined') {
			alert("streamid missing. aborting");
			return false;
		}
		state = 'getsid';
		var digest = hex_sha1(jabber.streamid + pass);
		frameLoad("login-sid","?jid="+msgEscape(jid)+"&digest="+digest);
		break;
	case 'getsid':
		if (jabber.error) {
			alert(loc("Login failed. Wrong password?"));
			return false;
		}
		window.open('jwchat.html?sid='+escape(jabber.sid)+"&jid="+escape(jid),makeWindowName(jid),'width=180,height=360,resizable=yes');
		break;
	}

	return false;
}

function frameLoad(func,param) {
	var frame = frames['hiddenframe'];
  var ext = ".jsx"; // protocol extension for wcs
  var ext2 = ".js";
  var url = sWCS + func + ext + param;
  var url2 = sWCS2 + func + ext2 + param;

  /* doesn't work with mozilla */
  if (is.ie || is.op) {
    frame.document.open();
    if (is.i5 || is.op)
      frame.document.write("<script src=\""+url2+"\"></script><script>function checkData() { if (typeof(jabber)=='undefined') setTimeout(\"checkData()\",100); else parent.handleEvent(); } onload = checkData;</script>");
    else 
      frame.document.write("<script src=\""+url2+"\"></script>");
    frame.document.close();
  } else    
    frame.location.href = url;
}

function toggleMoreOpts(show) {
	if (show) {
		document.getElementById('showMoreOpts').style.display = 'none';
		document.getElementById('showLessOpts').style.display = '';
	} else {
		document.getElementById('showLessOpts').style.display = 'none';
		document.getElementById('showMoreOpts').style.display = '';
	}

	var rows = document.getElementById('lTable').getElementsByTagName('TBODY').item(0).getElementsByTagName('TR');

	for (var i=0; i<rows.length; i++) {
		if (rows[i].className == 'moreOpts') {
			if (show)
				rows[i].style.display = '';
			else
				rows[i].style.display = 'none';
		}
	}
	return false;
}

function init() {
  var welcome = loc("Welcome to JWChat at [_1]", JABBERSERVER);
  document.title = welcome;
  document.getElementById("welcomeh1").innerHTML = welcome;
}

onload = init;
//-->
    </script>
    <style type="text/css">
			body {
			font-size: 0.8em; 
			color: #2a3847;
			}
			a { color: #2a3847; } 
			h1 { font-size: 1.4em; margin-top:0px; }
      .toggleOpts { cursor: pointer; }
    </style>
  </head>
  
  <body>

    <div style="padding: 20px;">

			<a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=92011&type=2" width="125" height="37" border="0" alt="SourceForge.net Logo" hspace=2 align=right /></a>
    <h1 id="welcomeh1"></h1>

      <p>
      <l>JWChat is a web based, full featured jabber client. <a href="http://www.jabber.org">Jabber</a> is an advanced  instant messaging system comparable to ICQ, AOL Instant Messenger or Yahoo!Messenger.</l></p>
        <p>
      <l>Use the form below to log into jabber and start your own web based client. You don't need to install any software at all to use this program.</l></p>
        <p>
      <l>If you don't have an account yet a new one can be created for you by checking the register flag below.</l></p>

    <fieldset style="margin: 20px; padding: 10px;"><legend><l>Login</l></legend>
    <table border=0 cellspacing=0 cellpadding=2 id="lTable">
      <form name="login" onSubmit="return loginCheck(this);">
      <tr>
        <td align=right><b><l>Username</l></b></td>
        <td><input type="text" name="jid" tabindex=1></td>
      </tr>
<tr><td colspan=2 nowrap><l>Username must not contain</l>: <script>document.write(prohibited)</script></td></tr>
			<tr><td colspan=2 height="10">&nbsp;</td></tr>
      <tr>
        <td align=right><b><l>Password</l></b></td>
        <td><input type="password" name="pass" tabindex=2></td>
      </tr>
      <tr><td>&nbsp;</td><td><input type=checkbox name=register id=register> <label for="register"><l>Register New Account</l></label></td></tr>
			<tr id="showMoreOpts" class="toggleOpts">
				<td colspan=2 onClick="return toggleMoreOpts(1);"><img src="images/group_close.gif" title="<l>Show More Options</l>"> <l>Show More Options</l></td>
			</tr>
			<tr id="showLessOpts" class="toggleOpts" style="display:none;">
				<td colspan=2 onClick="return toggleMoreOpts(0);"><img src="images/group_open.gif" title="<l>Show Less Options</l>"> <l>Show Less Options</l></td>
			</tr>
      <tr class="moreOpts" style="display:none;">
        <td align=right><b><l>Resource</l></b></td>
        <td><input type="text" name="res"></td>
      </tr>
      <tr class="moreOpts" style="display:none;">
        <td align=right><b><l>Priority</l></b><br>[unused]</td>
        <td><input type="text" name="prio"></td>
      </tr>
							
      <tr><td colspan="2" align=right><button type="submit" tabindex=3><l>Login</l></button></td></tr>
      </form>
    </table>
      </fieldset>

        <p>
      <l>If you want to learn more about JWChat please visit our homepage at <a href="http://jwchat.sourceforge.net">http://jwchat.sourceforge.net</a>!</l>

				<p>
				<h2><a href="https://sourceforge.net/donate/index.php?group_id=92011">Donate to JWChat</a></h2>
				If you feel happy and pleased with jwchat and would like to support its further development, any donations will be kindly appreciated.
				<div align=center>
				<a href="http://sourceforge.net/donate/index.php?group_id=92011"><img src="http://images.sourceforge.net/images/project-support.jpg" width="88" height="32" border="0" alt="Support This Project" style="padding-top: 10px;" /></a>
				</div>

    </div>
    <div style="padding-top: 10px; font-size: 8pt;">
      <hr noshade size=1 width=120 align=left color="#6c8bb1">
      &copy; 2003-2004 <a href="mailto:steve@zeank.in-berlin.de">Stefan Strigler</a> - 
      <!-- Created: Wed Feb  5 15:19:17 CET 2003 -->
      <!-- hhmts start -->
Last modified: Mon Sep 27 16:30:37 CEST 2004
<!-- hhmts end -->
    </div>
		<iframe src="empty.html" name="hiddenframe" id="hiddenframe" onload="handleEvent();" style="border:0;width:0;height:0;"></iframe>
  </body>
</html>
