<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title><l>JWChat - Annotation</l></title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script src="shared.js" language="JavaScript1.2"></script>
    <script src="browsercheck.js" language="JavaScript1.2"></script>
    <script src="emoticons.js" language="JavaScript1.2"></script>
    <script src="switchStyle.js"></script>
    <script language="JavaScript1.2">
      <!--
var srcW, jid;
function init() {
  srcW = opener;

  getArgs();

  if (typeof(passedArgs['jid']) == 'undefined')
    return;

  jid = passedArgs['jid'];

	var user = srcW.roster.getUserByJID(jid);
	if (!user)
		return; // unbelievable

  var titleStr = loc("Annotations for [_1]",user.name);
  document.title = titleStr;
  document.getElementById('title').innerHTML = titleStr;

  if (srcW.annotations[jid])
    document.getElementById('note').value = srcW.annotations[jid];
}

function saveNotes() {
  // save note
  srcW.annotations[jid] = document.getElementById('note').value;

  // store notes at server
  var xml = "<jwchat xmlns='jwchat:notes'>";

	for (var i in srcW.annotations)
		xml += "<item jid='"+i+"'>"+srcW.annotations[i]+"</item>";

	xml += '</jwchat>';
	srcW.fdebug(msgFormat(xml),0);
	srcW.fCBLoad("iq","?sid="+srcW.sid+"&ns=jabber:iq:private&set="+escape(xml));
}

onload = init;
onunload = saveNotes;
      //-->
    </script>
  </head>
  <body style="margin:8px;">
		<table width="100%" height="100%">
				<tr><td><h2 id="title"></h2></td></tr>
				<tr><td width="100%" height="100%"><textarea id="note" style="height:100%;width:100%;"></textarea></td></tr>
		</table>
  </body>
</html>
